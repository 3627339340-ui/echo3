<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>æœªæ¥å›éŸ³ ğŸ’Œ</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    html,body{height:100%;overflow:hidden;font-family:"PingFang SC","Segoe UI",sans-serif;}

    body {
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      transition:background 2s ease;
      background: radial-gradient(circle at 30% 20%, #fdf3f0, #f3e0dc);
    }

    /* å…‰æ–‘æ•ˆæœ */
    .decor {
      position:fixed;
      width:120vw;
      height:120vh;
      top:-10vh;
      left:-10vw;
      background:
        radial-gradient(circle at 25% 25%, rgba(255,200,220,0.18), transparent 60%),
        radial-gradient(circle at 80% 60%, rgba(255,250,200,0.12), transparent 60%),
        radial-gradient(circle at 60% 90%, rgba(200,220,255,0.15), transparent 70%);
      pointer-events:none;
      z-index:0;
      filter:blur(60px);
    }

    /* ä¿¡å°åŠ¨ç”» */
    .envelope {
      position:relative;
      width:220px;
      height:150px;
      background:#fff;
      border-radius:12px;
      box-shadow:0 8px 30px rgba(0,0,0,0.12);
      cursor:pointer;
      animation:shake 3s ease-in-out infinite;
      z-index:10;
    }
    .envelope::before {
      content:'';
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      clip-path:polygon(0 0,50% 60%,100% 0);
      background:linear-gradient(135deg,#fff,#f5f5f5);
      border-bottom:1px solid rgba(0,0,0,0.05);
      border-radius:12px 12px 0 0;
    }
    @keyframes shake {
      0%,100%{transform:rotate(0deg);}
      25%{transform:rotate(2deg);}
      50%{transform:rotate(-2deg);}
      75%{transform:rotate(1deg);}
    }

    /* ä¸»ç•Œé¢ */
    .main, .reply-page {
      display:none;
      flex-direction:column;
      align-items:center;
      width:100%;
      height:100%;
      z-index:10;
      position:relative;
    }

    h1 {
      color:#fff;
      font-size:2.4rem;
      letter-spacing:3px;
      margin-top:5vh;
      text-shadow:0 0 15px rgba(255,255,255,0.5);
    }

    .input-container {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      width:100%;
      padding:0 10vw;
    }

    .input-box {
      width:100%;
      max-width:700px;
      background:rgba(255,255,255,0.35);
      backdrop-filter:blur(12px);
      border-radius:28px;
      padding:40px;
      box-shadow:0 10px 35px rgba(0,0,0,0.1);
    }

    textarea {
      width:100%;
      height:280px;
      background:rgba(255,255,255,0.9);
      border:none;
      border-radius:20px;
      padding:18px;
      font-size:17px;
      outline:none;
      margin-bottom:25px;
      resize:none;
    }

    button {
      background:rgba(255,255,255,0.3);
      backdrop-filter:blur(10px);
      border:none;
      border-radius:25px;
      padding:14px 36px;
      font-size:16px;
      color:#333;
      cursor:pointer;
      transition:all 0.3s;
    }
    button:hover {
      background:rgba(255,255,255,0.5);
    }

    /* å›ä¿¡ç•Œé¢ */
    .reply-page {
      align-items:center;
      justify-content:center;
      padding:0 10vw 5vh;
    }

    .letter {
      width:100%;
      max-width:720px;
      background:rgba(255,255,255,0.96);
      border-radius:20px;
      padding:40px;
      box-shadow:0 12px 35px rgba(0,0,0,0.1);
      font-size:16px;
      line-height:1.8;
      color:#333;
      overflow-y:auto;
      max-height:65vh;
    }

    .reply-controls {
      margin-top:20px;
      display:flex;
      gap:20px;
      justify-content:center;
    }

  </style>
</head>
<body>

  <div class="decor"></div>

  <div class="envelope" id="envelope"></div>

  <div class="main" id="main">
    <h1>æœªæ¥å›éŸ³ ğŸ’Œ</h1>
    <div class="input-container">
      <div class="input-box">
        <textarea id="userInput" placeholder="å†™ä¸‹æ­¤åˆ»ä½ æƒ³å¯¹æœªæ¥çš„è‡ªå·±è¯´çš„è¯..."></textarea>
        <div style="text-align:center;">
          <button id="generateBtn">ç”Ÿæˆæœªæ¥å›ä¿¡</button>
        </div>
      </div>
    </div>
  </div>

  <div class="reply-page" id="replyPage">
    <div class="letter" id="replyContent"></div>
    <div class="reply-controls">
      <button id="playAudio">æ’­æ”¾è¯­éŸ³</button>
      <button id="stopAudio" style="display:none;">åœæ­¢æ’­æ”¾</button>
      <button id="collapseBtn">æ”¶èµ·å›ä¿¡</button>
    </div>
  </div>

  <script>
    const envelope = document.getElementById('envelope');
    const main = document.getElementById('main');
    const replyPage = document.getElementById('replyPage');
    const generateBtn = document.getElementById('generateBtn');
    const userInput = document.getElementById('userInput');
    const replyContent = document.getElementById('replyContent');
    const playAudioBtn = document.getElementById('playAudio');
    const stopAudioBtn = document.getElementById('stopAudio');
    const collapseBtn = document.getElementById('collapseBtn');
    let utter;

    // â° æ ¹æ®æ—¶é—´å˜åŒ–èƒŒæ™¯
    function updateBackgroundByTime() {
      const hour = new Date().getHours();
      let bg;
      if (hour >= 6 && hour < 12) {
        bg = 'radial-gradient(circle at 30% 20%, #fde8ec, #f7c9b6)';
      } else if (hour >= 12 && hour < 18) {
        bg = 'radial-gradient(circle at 30% 20%, #ffe9d2, #f7d8a9)';
      } else {
        bg = 'radial-gradient(circle at 30% 20%, #e4d4f7, #b8a3e8)';
      }
      document.body.style.background = bg;
    }
    updateBackgroundByTime();

    // ä¿¡å°åŠ¨ç”»
    function showMain(){
      envelope.style.display='none';
      main.style.display='flex';
    }
    envelope.addEventListener('click', showMain);
    setTimeout(showMain, 3000);

    // ç”Ÿæˆå›ä¿¡
    generateBtn.addEventListener('click', async ()=> {
      const text = userInput.value.trim();
      if(!text){alert('è¯·å†™ä¸‹ä½ çš„å¿ƒå£°â€¦'); return;}
      main.style.display='none';
      replyPage.style.display='flex';
      replyContent.textContent = "æ¥è‡ªæœªæ¥çš„ä¿¡æ­£åœ¨ç”Ÿæˆï¼Œè¯·ç¨å€™â€¦";

      try {
        const res = await fetch('/api/generate', {
          method:'POST',
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ prompt: text })
        });
        const data = await res.json();
        replyContent.textContent = data.reply || "æœªæ¥çš„ä½ æš‚æ—¶æ— è¯­ï¼Œè¯·ç¨åå†è¯•ã€‚";
      } catch(err){
        console.error(err);
        replyContent.textContent = "ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚";
      }
      playAudioBtn.style.display='inline-block';
      stopAudioBtn.style.display='none';
    });

    // æ’­æ”¾ä¸åœæ­¢è¯­éŸ³
    playAudioBtn.addEventListener('click', ()=> {
      const text = replyContent.textContent;
      playAudioBtn.style.display='none';
      stopAudioBtn.style.display='inline-block';
      utter = new SpeechSynthesisUtterance(text);
      utter.lang='zh-CN';
      utter.onend = ()=> {
        playAudioBtn.style.display='inline-block';
        stopAudioBtn.style.display='none';
      };
      speechSynthesis.speak(utter);
    });
    stopAudioBtn.addEventListener('click', ()=> {
      speechSynthesis.cancel();
      playAudioBtn.style.display='inline-block';
      stopAudioBtn.style.display='none';
    });

    // æ”¶èµ·å›ä¿¡
    collapseBtn.addEventListener('click', ()=> {
      speechSynthesis.cancel();
      replyPage.style.display='none';
      main.style.display='flex';
      userInput.value = '';
    });
  </script>

</body>
</html>
