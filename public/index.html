<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æœªæ¥å›éŸ³ ğŸ’Œ</title>
  <style>
    * {margin:0;padding:0;box-sizing:border-box;}
    body {
      height:100vh;display:flex;justify-content:center;align-items:center;
      background: radial-gradient(circle at center, #f7e6e8 45%, #d2a4a7 100%);
      font-family: "PingFang SC","Helvetica Neue",sans-serif;
      transition: background 1.2s ease;
      overflow:hidden;
    }
    .envelope {
      width:180px;height:120px;background:#fff;border-radius:8px;
      border:2px solid rgba(255,255,255,0.8);
      box-shadow:0 6px 20px rgba(0,0,0,0.1);
      animation: shake 3s ease-in-out infinite;
      position:relative;cursor:pointer;
    }
    .envelope::before{
      content:'';position:absolute;width:100%;height:100%;left:0;top:0;
      clip-path:polygon(0 0,50% 60%,100% 0);
      background:linear-gradient(135deg,#f7f7f7,#fafafa);
      border-bottom:1px solid rgba(0,0,0,0.05);
    }
    @keyframes shake{
      0%,100%{transform:rotate(0deg);}
      25%{transform:rotate(2deg);}
      50%{transform:rotate(-2deg);}
      75%{transform:rotate(1deg);}
    }
    .main,.reply-page{display:none;flex-direction:column;align-items:center;text-align:center;animation:fadeIn 1.2s ease forwards;}
    h1{color:white;font-size:2.3em;letter-spacing:4px;margin-bottom:30px;text-shadow:0 0 10px rgba(255,255,255,0.6);}
    .input-box{
      background:rgba(255,255,255,0.3);backdrop-filter:blur(10px);
      border-radius:20px;padding:25px;width:90%;max-width:450px;
      display:flex;flex-direction:column;align-items:center;
      box-shadow:0 10px 30px rgba(0,0,0,0.1);
    }
    textarea{
      width:100%;height:150px;border:none;border-radius:15px;padding:15px;
      background:rgba(255,255,255,0.9);font-size:16px;outline:none;margin-bottom:15px;resize:none;
    }
    button{
      background:rgba(255,255,255,0.35);backdrop-filter:blur(10px);
      border:none;border-radius:25px;padding:12px 28px;font-size:16px;
      transition:all 0.3s ease;cursor:pointer;color:#333;
    }
    button:hover{background:rgba(255,255,255,0.55);}
    .letter{
      background:rgba(255,255,255,0.9);
      border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,0.1);
      width:90%;max-width:500px;padding:25px;text-align:left;
      line-height:1.8;font-size:15px;color:#333;margin-bottom:20px;
      overflow-y:auto;max-height:300px;
    }
    .reply-controls{display:flex;gap:12px;justify-content:center;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
  </style>
</head>
<body>
  <div class="envelope" id="envelope"></div>

  <div class="main" id="main">
    <h1>æœªæ¥å›éŸ³ ğŸ’Œ</h1>
    <div class="input-box">
      <textarea id="userInput" placeholder="å†™ä¸‹ä½ æƒ³å¯¹æœªæ¥çš„è‡ªå·±è¯´çš„è¯..."></textarea>
      <button id="generateBtn">ç”Ÿæˆæœªæ¥å›ä¿¡</button>
    </div>
  </div>

  <div class="reply-page" id="replyPage">
    <div class="letter" id="replyContent"></div>
    <div class="reply-controls">
      <button id="playAudio">ğŸ”Š æ’­æ”¾è¯­éŸ³</button>
      <button id="stopAudio" style="display:none;">â¹ åœæ­¢æ’­æ”¾</button>
      <button id="collapseBtn">ğŸ“© æ”¶èµ·å›ä¿¡</button>
    </div>
  </div>

  <script>
    const envelope = document.getElementById("envelope");
    const main = document.getElementById("main");
    const replyPage = document.getElementById("replyPage");
    const generateBtn = document.getElementById("generateBtn");
    const userInput = document.getElementById("userInput");
    const replyContent = document.getElementById("replyContent");
    const playAudioBtn = document.getElementById("playAudio");
    const stopAudioBtn = document.getElementById("stopAudio");
    const collapseBtn = document.getElementById("collapseBtn");

    let audio;

    // ä¿¡å°ç‚¹å‡»æˆ–è‡ªåŠ¨å±•å¼€
    const showMain = () => {
      envelope.style.display = "none";
      main.style.display = "flex";
    };
    envelope.onclick = showMain;
    setTimeout(showMain, 3000);

    // è°ƒç”¨åç«¯ç”Ÿæˆå›ä¿¡
    generateBtn.onclick = async () => {
      const text = userInput.value.trim();
      if (!text) return alert("è¯·å†™ç‚¹ä»€ä¹ˆå§ ğŸ’­");
      main.style.display = "none";
      replyPage.style.display = "flex";
      replyContent.textContent = "ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™... âœ¨";

      try {
        const res = await fetch("/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text })
        });
        const data = await res.json();
        replyContent.textContent = data.reply || "ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚";
      } catch (err) {
        replyContent.textContent = "å‡ºé”™äº†ï¼Œè¯·ç¨åé‡è¯•ã€‚";
      }
    };

    // æ’­æ”¾è¯­éŸ³
    playAudioBtn.onclick = () => {
      const text = replyContent.textContent;
      playAudioBtn.style.display = "none";
      stopAudioBtn.style.display = "inline-block";
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "zh-CN";
      utter.rate = 1;
      utter.onend = () => {
        playAudioBtn.style.display = "inline-block";
        stopAudioBtn.style.display = "none";
      };
      speechSynthesis.speak(utter);
      audio = utter;
    };

    stopAudioBtn.onclick = () => {
      speechSynthesis.cancel();
      playAudioBtn.style.display = "inline-block";
      stopAudioBtn.style.display = "none";
    };

    collapseBtn.onclick = () => {
      replyPage.style.display = "none";
      main.style.display = "flex";
      userInput.value = "";
    };
  </script>
</body>
</html>
