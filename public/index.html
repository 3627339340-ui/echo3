<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æœªæ¥å›éŸ³ ğŸ’Œ</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="background-decor decor1"></div>
  <div class="background-decor decor2"></div>
  <div class="background-decor decor3"></div>

  <div class="container">
    <h1>æœªæ¥å›éŸ³ ğŸ’Œ</h1>
    <div id="envelope" class="envelope"></div>

    <div id="inputArea" style="display:none;">
      <textarea id="userInput" placeholder="å†™ä¸‹æ­¤åˆ»æƒ³å¯¹æœªæ¥çš„è‡ªå·±è¯´çš„è¯..."></textarea>
      <button id="generateBtn">ç”Ÿæˆæœªæ¥å›ä¿¡</button>
    </div>

    <div id="replyArea" style="display:none;">
      <div class="letter" id="replyText"></div>
      <div class="actions">
        <button id="voiceBtn">ğŸ”Š æ’­æ”¾è¯­éŸ³</button>
        <button id="closeBtn">ğŸ“© æ”¶èµ·å›ä¿¡</button>
      </div>
    </div>
  </div>

  <script>
    const envelope = document.getElementById("envelope");
    const inputArea = document.getElementById("inputArea");
    const replyArea = document.getElementById("replyArea");
    const generateBtn = document.getElementById("generateBtn");
    const replyText = document.getElementById("replyText");
    const voiceBtn = document.getElementById("voiceBtn");
    const closeBtn = document.getElementById("closeBtn");
    let speech;

    function showInput() {
      envelope.style.display = "none";
      inputArea.style.display = "flex";
      inputArea.style.flexDirection = "column";
      inputArea.style.alignItems = "center";
    }

    setTimeout(showInput, 3000);
    envelope.addEventListener("click", showInput);

    generateBtn.addEventListener("click", async () => {
      const message = document.getElementById("userInput").value.trim();
      if (!message) return alert("è¯·è¾“å…¥å†…å®¹ï½");

      replyText.innerText = "æ­£åœ¨å†™ä¿¡ä¸­ï¼Œè¯·ç¨å€™...";
      inputArea.style.display = "none";
      replyArea.style.display = "block";

      const res = await fetch("/api/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message })
      });

      const data = await res.json();
      replyText.innerText = data.reply || "ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•ã€‚";
    });

    voiceBtn.addEventListener("click", () => {
      if (speech) {
        window.speechSynthesis.cancel();
        speech = null;
        voiceBtn.textContent = "ğŸ”Š æ’­æ”¾è¯­éŸ³";
      } else {
        speech = new SpeechSynthesisUtterance(replyText.innerText);
        speech.lang = "zh-CN";
        window.speechSynthesis.speak(speech);
        voiceBtn.textContent = "â¹ åœæ­¢æ’­æ”¾";
        speech.onend = () => {
          voiceBtn.textContent = "ğŸ”Š æ’­æ”¾è¯­éŸ³";
          speech = null;
        };
      }
    });

    closeBtn.addEventListener("click", () => {
      replyArea.style.display = "none";
      inputArea.style.display = "flex";
    });
  </script>
</body>
</html>
