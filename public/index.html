<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>æœªæ¥å›éŸ³ ğŸ’Œ</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body {
      height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
      background: radial-gradient(circle at center, #f7f4f2 40%, #d9d6d3 100%);
      /* è£…é¥°æ¸å˜å…‰æ–‘ */
      background-image:
        radial-gradient(circle at 20% 30%, rgba(255,200,220,0.15) 0%, transparent 60%),
        radial-gradient(circle at 80% 70%, rgba(200,230,255,0.12) 0%, transparent 60%);
      transition: background 1s ease;
      font-family:"PingFang SC","Segoe UI",sans-serif;
      overflow:hidden;
    }

    /* ä¿¡å° */
    .envelope {
      width:200px;
      height:140px;
      background:#fff;
      border-radius:10px;
      box-shadow:0 8px 30px rgba(0,0,0,0.12);
      cursor:pointer;
      animation:shake 3s ease-in-out infinite;
      position: relative;
    }
    .envelope::before {
      content:'';
      position:absolute;
      top:0; left:0;
      width:100%; height:100%;
      clip-path: polygon(0 0, 50% 60%, 100% 0);
      background: linear-gradient(135deg, #fff, #f7f7f7);
      border-bottom:1px solid rgba(0,0,0,0.05);
      border-radius:10px 10px 0 0;
    }
    @keyframes shake {
      0%,100%{transform:rotate(0deg);}
      25%{transform:rotate(2deg);}
      50%{transform:rotate(-2deg);}
      75%{transform:rotate(1deg);}
    }

    /* ä¸»ç•Œé¢ è¾“å…¥ & ä¿¡çº¸ */
    .main, .reply-page {
      display:none;
      flex-direction:column;
      align-items:center;
      width:100%;
      height:100%;
    }
    h1 {
      color:#fff;
      font-size:2.4rem;
      letter-spacing:3px;
      margin-top:4vh;
      text-shadow:0 0 12px rgba(255,255,255,0.5);
    }

    .input-container {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      width:100%;
      padding:0 10vw;
    }
    .input-box {
      width:100%;
      max-width:600px;
      background:rgba(255,255,255,0.35);
      backdrop-filter:blur(12px);
      border-radius:24px;
      padding:30px;
      box-shadow:0 10px 30px rgba(0,0,0,0.1);
    }
    textarea {
      width:100%;
      height:220px;
      background:rgba(255,255,255,0.9);
      border:none;
      border-radius:15px;
      padding:18px;
      font-size:16px;
      outline:none;
      margin-bottom:20px;
      resize:none;
    }
    button {
      background:rgba(255,255,255,0.3);
      backdrop-filter:blur(10px);
      border:none;
      border-radius:25px;
      padding:14px 32px;
      font-size:16px;
      color:#333;
      cursor:pointer;
      transition:all 0.3s;
    }
    button:hover {
      background:rgba(255,255,255,0.5);
    }

    .reply-page {
      align-items:center;
      justify-content:center;
      padding:0 10vw 5vh;
    }
    .letter {
      width:100%;
      max-width:620px;
      background:rgba(255,255,255,0.96);
      border-radius:20px;
      padding:30px;
      box-shadow:0 12px 35px rgba(0,0,0,0.1);
      font-size:16px;
      line-height:1.8;
      color:#333;
      overflow-y:auto;
      max-height:60vh;
    }
    .reply-controls {
      margin-top:20px;
      display:flex;
      gap:16px;
      justify-content:center;
    }

  </style>
</head>
<body>

  <div class="envelope" id="envelope"></div>

  <!-- è¾“å…¥ç•Œé¢ -->
  <div class="main" id="main">
    <h1>æœªæ¥å›éŸ³ ğŸ’Œ</h1>
    <div class="input-container">
      <div class="input-box">
        <textarea id="userInput" placeholder="å†™ä¸‹æ­¤åˆ»ä½ æƒ³å¯¹æœªæ¥çš„è‡ªå·±è¯´çš„è¯..."></textarea>
        <div style="text-align:center;">
          <button id="generateBtn">ç”Ÿæˆæœªæ¥å›ä¿¡</button>
        </div>
      </div>
    </div>
  </div>

  <!-- å›ä¿¡ç•Œé¢ -->
  <div class="reply-page" id="replyPage">
    <div class="letter" id="replyContent"></div>
    <div class="reply-controls">
      <button id="playAudio">æ’­æ”¾è¯­éŸ³</button>
      <button id="stopAudio" style="display:none;">åœæ­¢æ’­æ”¾</button>
      <button id="collapseBtn">æ”¶èµ·å›ä¿¡</button>
    </div>
  </div>

  <script>
    const envelope = document.getElementById('envelope');
    const main = document.getElementById('main');
    const replyPage = document.getElementById('replyPage');
    const generateBtn = document.getElementById('generateBtn');
    const userInput = document.getElementById('userInput');
    const replyContent = document.getElementById('replyContent');
    const playAudioBtn = document.getElementById('playAudio');
    const stopAudioBtn = document.getElementById('stopAudio');
    const collapseBtn = document.getElementById('collapseBtn');
    let utter;

    function showMain(){
      envelope.style.display='none';
      main.style.display='flex';
    }
    envelope.addEventListener('click', showMain);
    setTimeout(showMain, 3000);

    generateBtn.addEventListener('click', async ()=> {
      const text = userInput.value.trim();
      if(!text){alert('è¯·å†™ä¸‹ä½ çš„å¿ƒå£°â€¦'); return;}
      main.style.display='none';
      replyPage.style.display='flex';
      replyContent.textContent = "æ¥è‡ªæœªæ¥çš„ä¿¡æ­£åœ¨ç”Ÿæˆï¼Œè¯·ç¨å€™â€¦";

      try {
        const res = await fetch('/api/generate', {
          method:'POST',
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ prompt: text })
        });
        const data = await res.json();
        replyContent.textContent = data.reply || "æœªæ¥çš„ä½ æš‚æ—¶æ— è¯­ï¼Œè¯·ç¨åå†è¯•ã€‚";
      } catch(err){
        console.error(err);
        replyContent.textContent = "ç”Ÿæˆå¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚";
      }
      playAudioBtn.style.display='inline-block';
      stopAudioBtn.style.display='none';
    });

    playAudioBtn.addEventListener('click', ()=> {
      const text = replyContent.textContent;
      playAudioBtn.style.display='none';
      stopAudioBtn.style.display='inline-block';
      utter = new SpeechSynthesisUtterance(text);
      utter.lang='zh-CN';
      utter.onend = ()=> {
        playAudioBtn.style.display='inline-block';
        stopAudioBtn.style.display='none';
      };
      speechSynthesis.speak(utter);
    });

    stopAudioBtn.addEventListener('click', ()=> {
      speechSynthesis.cancel();
      playAudioBtn.style.display='inline-block';
      stopAudioBtn.style.display='none';
    });

    collapseBtn.addEventListener('click', ()=> {
      speechSynthesis.cancel();
      replyPage.style.display='none';
      main.style.display='flex';
      userInput.value = '';
    });
  </script>

</body>
</html>
